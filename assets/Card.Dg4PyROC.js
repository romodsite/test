import{j as e}from"./index.xDGvdcGR.js";import{r as t,L as s}from"./router.BuKbULCr.js";import{G as a,q as l,s as r,t as i,y as o,v as n}from"./App.CWrh0A6d.js";function d(e){return a({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 480a16 16 0 0 1-16-16V68.13a24 24 0 0 1 11.9-20.72C88 40.38 112.38 32 160 32c37.21 0 78.83 14.71 115.55 27.68C305.12 70.13 333.05 80 352 80a183.84 183.84 0 0 0 71-14.5 18 18 0 0 1 25 16.58v219.36a20 20 0 0 1-12 18.31c-8.71 3.81-40.51 16.25-84 16.25-24.14 0-54.38-7.14-86.39-14.71C229.63 312.79 192.43 304 160 304c-36.87 0-55.74 5.58-64 9.11V464a16 16 0 0 1-16 16z"},child:[]}]})(e)}const c=({id:a,image:c,link:h,title:u,genres:p,username:m,className:x,user:g,onDelete:b,createPost:j=!1,reportStatus:f=null,isPending:w=!1,isRejected:y=!1,reason:v=null,isReported:N=!1,isPostDeleted:k=!1})=>{const[C,z]=t.useState(!0),[S,R]=t.useState(!1),[L,I]=t.useState(""),[P,T]=t.useState(""),[A,D]=t.useState(!1),[B,O]=t.useState(!1),[E,U]=t.useState(!1),V={"Link does not work":1,"Inappropriate content":2,"Not compliant with site rules":3,Other:4};return t.useEffect((()=>{c&&((new Image).src=c)}),[c]),C?e.jsx("div",{className:"relative "+(x||""),children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gray-800"}),e.jsx("img",{src:c,alt:u,loading:"eager",decoding:"async",onLoad:()=>U(!0),className:"absolute inset-0 w-full h-full object-cover z-0 transition-opacity duration-300 "+(E?"opacity-100":"opacity-0"),width:"266",height:"300",fetchPriority:"high"}),!E&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 z-0",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),f&&e.jsx("div",{className:"absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white\n                        "+("pending"===f?"bg-yellow-500":"accepted"===f?"bg-green-500":"rejected"===f?"bg-red-500":"bg-gray-500"),children:"pending"===f?"Pending":"accepted"===f?"Kept":"rejected"===f?"Deleted":f}),w&&e.jsx("div",{className:"absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white bg-yellow-500",children:"Awaiting moderation"}),y&&e.jsx("div",{className:"absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white bg-red-500",children:"Rejected"}),(y||f&&"pending"!==f||k)&&v&&e.jsx("div",{className:"absolute top-2 left-2 z-10 bg-gray-800 bg-opacity-80 rounded-full p-1 cursor-pointer",onClick:()=>O(!B),role:"button","aria-label":"Show reason",children:e.jsx(l,{className:"text-white text-lg"})}),B&&v&&e.jsx("div",{className:"absolute inset-0 z-20 bg-gray-900 bg-opacity-95 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg max-w-md w-full",children:[e.jsx("h3",{className:"text-white font-bold text-lg mb-2",children:"Reason:"}),e.jsx("p",{className:"text-white text-sm mb-4",children:v}),e.jsx("button",{onClick:()=>O(!1),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full",children:"Close"})]})}),(null==g?void 0:g.username)===m&&!j&&!w&&!y&&e.jsx("div",{async onClick(){if(window.confirm("Are you sure you want to delete this post?"))try{await i(a),o.success("Post deleted successfully"),z(!1),b&&b(a)}catch(e){o.error(e.message||"Failed to delete post")}},className:"card-delete",children:e.jsx("button",{className:"text-white","aria-label":"Delete post",children:e.jsx(r,{size:20})})}),(null==g?void 0:g.username)!==m&&!w&&!y&&(!N||f&&"pending"!==f)&&e.jsx("div",{onClick:()=>R(!S),className:"card-report",children:e.jsx("button",{className:"text-white","aria-label":"Report post",children:e.jsx(d,{size:22})})}),!y&&!N&&!k&&e.jsx("a",{href:h,target:"_blank",rel:"nofollow noreferrer",className:"absolute inset-0 z-1","aria-label":"Redirect to a pack named "+u}),e.jsx("p",{className:"w-max z-10 relative card-title",children:y||N||k?e.jsx("span",{children:u}):e.jsx("a",{href:h,className:"card-title",target:"_blank",rel:"nofollow noreferrer","aria-label":"Redirect to a pack named "+u,children:u})}),e.jsx("div",{className:"flex flex-wrap gap-2 z-10 w-full card-genres relative",children:p.map(((t,a)=>e.jsx(s,{to:"/search/genre/"+encodeURIComponent(t),children:e.jsx("div",{className:t.toLowerCase()+" tag h-min",children:t})},a)))}),e.jsx("p",{className:"w-max z-10 relative card-username",children:k?"By "+m:e.jsxs(s,{to:"/search/user/"+encodeURIComponent(m),children:["By ",m]})}),S&&e.jsxs("div",{className:"flex flex-col justify-between absolute top-0 right-0 bg-gray-800 text-white rounded shadow-lg p-4 w-full h-full z-10",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-2",children:"Report this post"}),e.jsx("p",{className:"mb-2",children:"Select a reason:"}),e.jsxs("select",{value:L,onChange:e=>I(e.target.value),className:"w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-2 mb-2",disabled:A,children:[e.jsx("option",{value:"",disabled:!0,children:"Choose a reason"}),e.jsx("option",{value:"Link does not work",children:"Link does not work"}),e.jsx("option",{value:"Inappropriate content",children:"Inappropriate content"}),e.jsx("option",{value:"Not compliant with site rules",children:"Not compliant with site rules"}),e.jsx("option",{value:"Other",children:"Other"})]}),"Link does not work"===L&&e.jsxs("div",{className:"mb-2 text-yellow-300 text-sm",children:[e.jsx("p",{children:"This option will automatically check if the link works."}),e.jsx("p",{children:"If the link is inaccessible, the post will be automatically deleted."})]}),"Link does not work"!==L&&e.jsx("textarea",{placeholder:"Additional comment (optional)",value:P,onChange:e=>T(e.target.value),className:"w-full h-26 bg-gray-700 text-white border border-gray-600 rounded-lg p-2 mb-2 resize-none",disabled:A}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{async onClick(){if(L)try{D(!0);const e=V[L]||null;let t;1===e?(t=L,T("")):t=P?`${L} - Comment: ${P}`:L;const s=await n(a,u,h,t,e);1===e?!1===s.accessible?(o.info("The link is no longer accessible. The post has been automatically deleted.",{icon:"🔗❌"}),z(!1),b&&setTimeout((()=>{b(a)}),100)):!0===s.accessible&&o.error("The link is currently accessible. The post has not been deleted."):o.success(s.message||"Report sent successfully"),R(!1),I(""),T("")}catch(e){const t=e.message||"Error sending report";t.toLowerCase().includes("already reported")?o.info("You have already reported this post"):o.error(t)}finally{D(!1)}else o.error("Please select a reason for the report.")},className:(A?"bg-gray-500":"bg-green-500 hover:bg-green-600")+" text-white px-3 py-1 rounded-lg",disabled:A,children:A?"Sending...":"Send"}),e.jsx("button",{onClick:()=>R(!1),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg",disabled:A,children:"Cancel"})]})]})]})}):null};export{c as C};
