import{j as e}from"./index.BQRiHLz8.js";import{r as t,L as s}from"./router.CamqIhIv.js";import{a3 as a,a1 as l,S as r,O as i,a4 as o,y as n,a5 as d}from"./App.CygJ2Zu7.js";function c(e){return a({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 480a16 16 0 0 1-16-16V68.13a24 24 0 0 1 11.9-20.72C88 40.38 112.38 32 160 32c37.21 0 78.83 14.71 115.55 27.68C305.12 70.13 333.05 80 352 80a183.84 183.84 0 0 0 71-14.5 18 18 0 0 1 25 16.58v219.36a20 20 0 0 1-12 18.31c-8.71 3.81-40.51 16.25-84 16.25-24.14 0-54.38-7.14-86.39-14.71C229.63 312.79 192.43 304 160 304c-36.87 0-55.74 5.58-64 9.11V464a16 16 0 0 1-16 16z"},child:[]}]})(e)}const h=({id:a,image:h,link:u,title:p,genres:m,username:x,className:g,user:b,onDelete:j,createPost:f=!1,reportStatus:w=null,isPending:y=!1,isRejected:v=!1,reason:N=null,isReported:k=!1,isPostDeleted:C=!1,monetized:z=!1})=>{const[S,R]=t.useState(!0),[L,I]=t.useState(!1),[P,T]=t.useState(""),[A,D]=t.useState(""),[O,B]=t.useState(!1),[E,U]=t.useState(!1),[V,$]=t.useState(!1),_={"Link does not work":1,"Inappropriate content":2,"Not compliant with site rules":3,Other:4};return t.useEffect((()=>{h&&((new Image).src=h)}),[h]),S?e.jsx("div",{className:"relative "+(g||""),children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gray-800"}),e.jsx("img",{src:h,alt:p,loading:"eager",decoding:"async",onLoad:()=>$(!0),className:"absolute inset-0 w-full h-full object-cover z-0 transition-opacity duration-300 "+(V?"opacity-100":"opacity-0"),width:"266",height:"300",fetchPriority:"high"}),!V&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 z-0",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),z&&e.jsx("div",{className:"absolute bottom-2 right-2 z-10 p-1.5 bg-gray-700 bg-opacity-60 rounded-full",children:e.jsx(l,{className:"text-green-400",size:16})}),w&&e.jsx("div",{className:"absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white\n                        "+("pending"===w?"bg-yellow-500":"accepted"===w?"bg-green-500":"rejected"===w?"bg-red-500":"bg-gray-500"),children:"pending"===w?"Pending":"accepted"===w?"Kept":"rejected"===w?"Deleted":w}),y&&e.jsx("div",{className:"absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white bg-yellow-500",children:"Awaiting moderation"}),v&&e.jsx("div",{className:"absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white bg-red-500",children:"Rejected"}),(v||w&&"pending"!==w||C)&&N&&e.jsx("div",{className:"absolute top-2 left-2 z-10 bg-gray-800 bg-opacity-80 rounded-full p-1 cursor-pointer",onClick:()=>U(!E),role:"button","aria-label":"Show reason",children:e.jsx(r,{className:"text-white text-lg"})}),E&&N&&e.jsx("div",{className:"absolute inset-0 z-20 bg-gray-900 bg-opacity-95 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg max-w-md w-full",children:[e.jsx("h3",{className:"text-white font-bold text-lg mb-2",children:"Reason:"}),e.jsx("p",{className:"text-white text-sm mb-4",children:N}),e.jsx("button",{onClick:()=>U(!1),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full",children:"Close"})]})}),(null==b?void 0:b.username)===x&&!f&&!y&&!v&&e.jsx("div",{async onClick(){if(window.confirm("Are you sure you want to delete this post?"))try{await o(a),n.success("Post deleted successfully"),R(!1),j&&j(a)}catch(e){n.error(e.message||"Failed to delete post")}},className:"card-delete",children:e.jsx("button",{className:"text-white","aria-label":"Delete post",children:e.jsx(i,{size:20})})}),(null==b?void 0:b.username)!==x&&!y&&!v&&(!k||w&&"pending"!==w)&&e.jsx("div",{onClick:()=>I(!L),className:"card-report",children:e.jsx("button",{className:"text-white","aria-label":"Report post",children:e.jsx(c,{size:22})})}),!v&&!k&&!C&&e.jsx("a",{href:u,target:"_blank",rel:"nofollow noreferrer",className:"absolute inset-0 z-1","aria-label":"Redirect to a pack named "+p}),e.jsx("p",{className:"w-max z-10 relative card-title",children:v||k||C?e.jsx("span",{children:p}):e.jsx("a",{href:u,className:"card-title",target:"_blank",rel:"nofollow noreferrer","aria-label":"Redirect to a pack named "+p,children:p})}),e.jsx("div",{className:"flex flex-wrap gap-2 z-10 w-full card-genres relative",children:m.map(((t,a)=>e.jsx(s,{to:"/search/genre/"+encodeURIComponent(t),children:e.jsx("div",{className:t.toLowerCase()+" tag h-min",children:t})},a)))}),e.jsx("p",{className:"w-max z-10 relative card-username",children:C?"By "+x:e.jsxs(s,{to:"/search/user/"+encodeURIComponent(x),children:["By ",x]})}),L&&e.jsxs("div",{className:"flex flex-col justify-between absolute top-0 right-0 bg-gray-800 text-white rounded shadow-lg p-4 w-full h-full z-10",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-2",children:"Report this post"}),e.jsx("p",{className:"mb-2",children:"Select a reason:"}),e.jsxs("select",{value:P,onChange:e=>T(e.target.value),className:"w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-2 mb-2",disabled:O,children:[e.jsx("option",{value:"",disabled:!0,children:"Choose a reason"}),e.jsx("option",{value:"Link does not work",children:"Link does not work"}),e.jsx("option",{value:"Inappropriate content",children:"Inappropriate content"}),e.jsx("option",{value:"Not compliant with site rules",children:"Not compliant with site rules"}),e.jsx("option",{value:"Other",children:"Other"})]}),"Link does not work"===P&&e.jsxs("div",{className:"mb-2 text-yellow-300 text-sm",children:[e.jsx("p",{children:"This option will automatically check if the link works."}),e.jsx("p",{children:"If the link is inaccessible, the post will be automatically deleted."})]}),"Link does not work"!==P&&e.jsx("textarea",{placeholder:"Additional comment (optional)",value:A,onChange:e=>D(e.target.value),className:"w-full h-26 bg-gray-700 text-white border border-gray-600 rounded-lg p-2 mb-2 resize-none",disabled:O}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{async onClick(){if(P)try{B(!0);const e=_[P]||null;let t;1===e?(t=P,D("")):t=A?`${P} - Comment: ${A}`:P;const s=await d(a,p,u,t,e);1===e?!1===s.accessible?(n.info("The link is no longer accessible. The post has been automatically deleted.",{icon:"🔗❌"}),R(!1),j&&setTimeout((()=>{j(a)}),100)):!0===s.accessible&&n.error("The link is currently accessible. The post has not been deleted."):n.success(s.message||"Report sent successfully"),I(!1),T(""),D("")}catch(e){const t=e.message||"Error sending report";t.toLowerCase().includes("already reported")?n.info("You have already reported this post"):n.error(t)}finally{B(!1)}else n.error("Please select a reason for the report.")},className:(O?"bg-gray-500":"bg-green-500 hover:bg-green-600")+" text-white px-3 py-1 rounded-lg",disabled:O,children:O?"Sending...":"Send"}),e.jsx("button",{onClick:()=>I(!1),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg",disabled:O,children:"Cancel"})]})]})]})}):null};export{h as C};
