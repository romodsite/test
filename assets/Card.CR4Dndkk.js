import{r,j as e}from"./index.R1rO9--g.js";import{G as F,o as _,p as G,L as $,q as M,y as n,s as T}from"./App.CvAjmVrL.js";function H(i){return F({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 480a16 16 0 0 1-16-16V68.13a24 24 0 0 1 11.9-20.72C88 40.38 112.38 32 160 32c37.21 0 78.83 14.71 115.55 27.68C305.12 70.13 333.05 80 352 80a183.84 183.84 0 0 0 71-14.5 18 18 0 0 1 25 16.58v219.36a20 20 0 0 1-12 18.31c-8.71 3.81-40.51 16.25-84 16.25-24.14 0-54.38-7.14-86.39-14.71C229.63 312.79 192.43 304 160 304c-36.87 0-55.74 5.58-64 9.11V464a16 16 0 0 1-16 16z"},child:[]}]})(i)}const K=({id:i,image:A,link:h,title:o,genres:E,username:m,className:P,user:c,onDelete:p,createPost:q=!1,reportStatus:t=null,isPending:g=!1,isRejected:d=!1,reason:b=null,isReported:j=!1,isPostDeleted:x=!1})=>{const[V,N]=r.useState(!0),[z,f]=r.useState(!1),[a,C]=r.useState(""),[y,v]=r.useState(""),[u,S]=r.useState(!1),[L,k]=r.useState(!1),[R,B]=r.useState(!1),D={"Le lien ne fonctionne pas":1,"Contenu inapproprié":2,"Non conforme aux règles du site":3,Autre:4};return V?e.jsx("div",{className:`relative ${P||""}`,children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gray-800"}),e.jsx("img",{src:A,alt:o,loading:"lazy",decoding:"async",onLoad:()=>B(!0),className:"absolute inset-0 w-full h-full object-cover z-0 transition-opacity duration-300",width:"300",height:"450",style:{opacity:R?1:0},fetchPriority:"high"}),!R&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800 z-0",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),t&&e.jsx("div",{className:`absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white
                        `+(t==="pending"?"bg-yellow-500":t==="accepted"?"bg-green-500":t==="rejected"?"bg-red-500":"bg-gray-500"),children:t==="pending"?"En attente":t==="accepted"?"Conservé":t==="rejected"?"Supprimé":t}),g&&e.jsx("div",{className:"absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white bg-yellow-500",children:"En attente de modération"}),d&&e.jsx("div",{className:"absolute top-2 right-2 z-10 px-2 py-1 rounded-full text-xs font-medium text-white bg-red-500",children:"Rejeté"}),(d||t&&t!=="pending"||x)&&b&&e.jsx("div",{className:"absolute top-2 left-2 z-10 bg-gray-800 bg-opacity-80 rounded-full p-1 cursor-pointer",onClick:()=>k(!L),role:"button","aria-label":"Show reason",children:e.jsx(_,{className:"text-white text-lg"})}),L&&b&&e.jsx("div",{className:"absolute inset-0 z-20 bg-gray-900 bg-opacity-95 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg max-w-md w-full",children:[e.jsx("h3",{className:"text-white font-bold text-lg mb-2",children:"Raison :"}),e.jsx("p",{className:"text-white text-sm mb-4",children:b}),e.jsx("button",{onClick:()=>k(!1),className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full",children:"Fermer"})]})}),(c==null?void 0:c.username)===m&&!q&&!g&&!d&&e.jsx("div",{onClick:async()=>{if(window.confirm("Are you sure you want to delete this post?"))try{await M(i),n.success("Post deleted successfully"),N(!1),p&&p(i)}catch(s){n.error(s.message||"Failed to delete post")}},className:"card-delete",children:e.jsx("button",{className:"text-white","aria-label":"Delete post",children:e.jsx(G,{size:20})})}),(c==null?void 0:c.username)!==m&&!g&&!d&&(!j||t&&t!=="pending")&&e.jsx("div",{onClick:()=>f(!z),className:"card-report",children:e.jsx("button",{className:"text-white","aria-label":"Report post",children:e.jsx(H,{size:22})})}),!d&&!j&&!x&&e.jsx("a",{href:h,target:"_blank",rel:"noreferrer",className:"absolute inset-0 z-1","aria-label":"Redirect to a pack named "+o}),e.jsx("h2",{className:"w-max z-10 relative",children:d||j||x?e.jsx("span",{children:o}):e.jsx("a",{href:h,target:"_blank",rel:"noreferrer","aria-label":"Redirect to a pack named "+o,children:o})}),e.jsx("div",{className:"flex flex-wrap gap-2 z-10 w-full card-genres relative",children:E.map((s,l)=>e.jsx($,{to:`/search?g=${s}`,children:e.jsx("div",{className:s.toLowerCase()+" tag h-min",children:s})},l))}),e.jsx("p",{className:"w-max z-10 relative",children:x?`By ${m}`:e.jsxs($,{to:`/search?u=${m}`,children:["By ",m]})}),z&&e.jsxs("div",{className:"flex flex-col justify-between absolute top-0 right-0 bg-gray-800 text-white rounded shadow-lg p-4 w-full h-full z-10",children:[e.jsx("h3",{className:"text-2xl font-semibold mb-2",children:"Signaler ce post"}),e.jsx("p",{className:"mb-2",children:"Sélectionner une raison :"}),e.jsxs("select",{value:a,onChange:s=>C(s.target.value),className:"w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-2 mb-2",disabled:u,children:[e.jsx("option",{value:"",disabled:!0,children:"Choisir une raison"}),e.jsx("option",{value:"Le lien ne fonctionne pas",children:"Le lien ne fonctionne pas"}),e.jsx("option",{value:"Contenu inapproprié",children:"Contenu inapproprié"}),e.jsx("option",{value:"Non conforme aux règles du site",children:"Non conforme aux règles du site"}),e.jsx("option",{value:"Autre",children:"Autre"})]}),a==="Le lien ne fonctionne pas"&&e.jsxs("div",{className:"mb-2 text-yellow-300 text-sm",children:[e.jsx("p",{children:"Cette option vérifiera automatiquement si le lien fonctionne."}),e.jsx("p",{children:"Si le lien est inaccessible, le post sera supprimé automatiquement."})]}),a!=="Le lien ne fonctionne pas"&&e.jsx("textarea",{placeholder:"Commentaire supplémentaire (optionnel)",value:y,onChange:s=>v(s.target.value),className:"w-full h-26 bg-gray-700 text-white border border-gray-600 rounded-lg p-2 mb-2 resize-none",disabled:u}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:async()=>{if(a)try{S(!0);const s=D[a]||null;let l;s===1?(l=a,v("")):l=y?`${a} - Commentaire: ${y}`:a;const w=await T(i,o,h,l,s);s===1?w.accessible===!1?(n.info("Le lien n'est plus accessible. Le post a été supprimé automatiquement.",{icon:"🔗❌"}),N(!1),p&&setTimeout(()=>{p(i)},100)):w.accessible===!0&&n.error("Le lien est actuellement accessible. Le post n'a pas été supprimé."):n.success(w.message||"Signalement envoyé avec succès"),f(!1),C(""),v("")}catch(s){const l=s.message||"Erreur lors de l'envoi du signalement";l.toLowerCase().includes("already reported")?n.info("Vous avez déjà signalé ce post"):n.error(l)}finally{S(!1)}else n.error("Veuillez sélectionner une raison pour le signalement.")},className:(u?"bg-gray-500":"bg-green-500 hover:bg-green-600")+" text-white px-3 py-1 rounded-lg",disabled:u,children:u?"Envoi...":"Envoyer"}),e.jsx("button",{onClick:()=>f(!1),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg",disabled:u,children:"Annuler"})]})]})]})}):null};export{K as C};
